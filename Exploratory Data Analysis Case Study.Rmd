---
title: "Exploratory Data Analysis Case Study"
author: "Hanxi Gu"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(scales)
library(lmPerm)
knitr::opts_chunk$set(fig.width=10)
BlackFriday = read_csv("BlackFriday_data.csv", show_col_types = FALSE)
BlackFriday
```

##  Utility functions

```{r}
summarize_numeric = function(dataset) {
  
  dataset = select_if(dataset, is.numeric)
  summary.table = data.frame(Attribute = names(dataset))
  
  summary.table = summary.table %>% 
    mutate('Missing Values' = apply(dataset, 2, function (x) sum(is.na(x))),
           'Unique Values' = apply(dataset, 2, function (x) length(unique(x))),
           'Mean' = colMeans(dataset, na.rm = TRUE),
           'Min' = apply(dataset, 2, function (x) min(x, na.rm = TRUE)),
           'Max' = apply(dataset, 2, function (x) max(x, na.rm = TRUE)),
           'SD' = apply(dataset, 2, function (x) sd(x, na.rm = TRUE))
    )
  summary.table
}

summarize_character = function(dataset) {
  
  dataset = select_if(dataset, is.character)
  summary.table = data.frame(Attribute = names(dataset))
  
  summary.table = summary.table %>% 
    mutate('Missing Values' = apply(dataset, 2, function (x) sum(is.na(x))),
           'Unique Values' = apply(dataset, 2, function (x) length(unique(x))),
    )
  summary.table
}
```

```{r}
summarize_character(BlackFriday)
```


```{r}
summarize_numeric(BlackFriday)
```
##  Initial Data Review

### Convert Factors/Measures

```{r}
BlackFriday <- BlackFriday %>% mutate(User_ID = as.factor(User_ID))
BlackFriday <- BlackFriday %>% mutate(Occupation = as.factor(Occupation))
BlackFriday <- BlackFriday %>% mutate(Stay_In_Current_City_Years = as.factor(Stay_In_Current_City_Years))
BlackFriday <- BlackFriday %>% mutate(Marital_Status = as.factor(Marital_Status))
BlackFriday <- BlackFriday %>% mutate(Product_Category_1 = as.factor(Product_Category_1))
BlackFriday <- BlackFriday %>% mutate(Product_Category_2 = as.factor(Product_Category_2))
BlackFriday <- BlackFriday %>% mutate(Product_Category_3 = as.factor(Product_Category_3))
BlackFriday <- BlackFriday %>% mutate(Product_ID = as.factor(Product_ID))
BlackFriday <- BlackFriday %>% mutate(Gender = as.factor(Gender))
BlackFriday <- BlackFriday %>% mutate(Age = as.factor(Age))
BlackFriday <- BlackFriday %>% mutate(City_Category = as.factor(City_Category))
```

```{r}
summarize_factor = function(dataset) {
  
  dataset = select_if(dataset, is.factor)
  summary.table = data.frame(Attribute = names(dataset))
  
  summary.table = summary.table %>% 
    mutate('Missing Values' = apply(dataset, 2, function (x) sum(is.na(x))),
           'Unique Values' = apply(dataset, 2, function (x) length(unique(x))),
           'Mode' = apply(dataset, 2, function(x)mode(x))
    )
  summary.table
}

summarize_factor(BlackFriday)
```

```{r}
BlackFriday_cleaned <- na.omit(BlackFriday)
BlackFriday_cleaned

User_data <- BlackFriday_cleaned %>%
  select(User_ID, Gender, Age, Occupation, City_Category, Stay_In_Current_City_Years, Marital_Status, Purchase)
cleaned_User_data <- User_data %>%
  group_by(User_ID) %>%
  summarize(
    Gender = first(Gender),
    Age = first(Age),
    Occupation = first(Occupation),
    City_Category = first(City_Category),
    Stay_In_Current_City_Years = first(Stay_In_Current_City_Years),
    Marital_Status = first(Marital_Status),
    Total_Purchase = sum(Purchase),
    Avg_Purchase = mean(Purchase),
    Max_Purchase = max(Purchase),
    Min_Purchase = min(Purchase),
    Num_Purchases = n()  # Number of purchases made by each customer
  )

Product_data <- BlackFriday_cleaned %>%
  select(Product_ID, Product_Category_1, Product_Category_2, Product_Category_3, Purchase)
cleaned_Product_data <- Product_data %>%
  group_by(Product_ID) %>%
  summarize(
    Product_Category_1 = first(Product_Category_1),
    Product_Category_2 = first(Product_Category_2),
    Product_Category_3 = first(Product_Category_3),
    Total_Purchase = sum(Purchase),
    Num_Purchases = n()  # Number of purchases made by each customer
  )

write.csv(cleaned_Product_data, file = "cleaned_Product.csv", row.names = FALSE)
write.csv(cleaned_User_data, file = "cleaned_User.csv", row.names = FALSE)

cleaned_Product_data
```

```{r}
options(scipen = 999)
summarize_character(cleaned_User_data)
summarize_numeric(cleaned_User_data)
```

```{r}
options(scipen = 999)
summarize_character(cleaned_Product_data)
summarize_numeric(cleaned_Product_data)
```

```{r}
ggplot(cleaned_User_data) + 
  geom_histogram(aes(x = Total_Purchase), fill = "#e8615b") +
  ggtitle("Purchase Amount") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )+
  scale_x_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data) + 
  geom_histogram(aes(x = Num_Purchases), fill = "#e8615b") +
  ggtitle("Number of Purchase") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )+
  scale_x_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data) + 
  geom_bar(aes(x = Gender), fill = "#e8615b") +
  ggtitle("Gender") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20)
  ) +
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data) + geom_bar(aes(x = Age), fill = "#e8615b") +
  ggtitle("Age") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )
```

```{r}
ggplot(cleaned_User_data) + geom_bar(aes(x = Occupation), fill = "#e8615b") +
  ggtitle("Occupation") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )
```

```{r}
ggplot(cleaned_User_data) + geom_bar(aes(x = City_Category), fill = "#e8615b") +
  ggtitle("City_Category") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )
```

```{r}
ggplot(cleaned_User_data) + geom_bar(aes(x = Stay_In_Current_City_Years), fill = "#e8615b") +
  ggtitle("Stay_In_Current_City_Years") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )
```

```{r}
ggplot(cleaned_User_data) + 
  geom_bar(aes(x = Marital_Status), fill = "#e8615b") +
  ggtitle("Marital Status") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20)
  ) +
  scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))
```

```{r}
ggplot(cleaned_Product_data) + 
  geom_histogram(aes(x = Total_Purchase), fill = "#efac37") +
  ggtitle("Purchase Amount") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )+
  scale_x_continuous(labels = comma)
```

```{r}
ggplot(cleaned_Product_data) + 
  geom_histogram(aes(x = Num_Purchases), fill = "#efac37") +
  ggtitle("Number of Purchase") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),  
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),  
    axis.title = element_text(size = 20)   
  )+
  scale_x_continuous(labels = comma)
```


```{r}
ggplot(cleaned_Product_data) + 
  geom_bar(aes(x = Product_Category_1), fill = "#efac37") +
  ggtitle("Product Category 1") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20)
  ) 
```



```{r}
ggplot(cleaned_Product_data) + 
  geom_bar(aes(x = Product_Category_2), fill = "#efac37") +
  ggtitle("Product Category 2") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20)
  ) 
```

```{r}
ggplot(cleaned_Product_data) + 
  geom_bar(aes(x = Product_Category_3), fill = "#efac37") +
  ggtitle("Product Category 3") +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.5, size = 25),
    axis.title.x = element_blank(),
    axis.text = element_text(size = 20),
    axis.title = element_text(size = 20)
  )  +
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = Gender, y = Total_Purchase, fill = Gender)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "Gender") +
  theme_minimal() +
  scale_fill_manual(values = c("M" = "#efac37", "F" = "#e8615b")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = Age, y = Total_Purchase, fill = Age)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "Age") +
  theme_minimal() +
  scale_fill_manual(values = c("0-17" = "#2f4a7f", "18-25" = "#efac37", "26-35" = "#162e4c", "36-45" = "#e8615b", "46-50" = "#476b9e", "51-55" = "#e5931c", "55+" = "#5982b2")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = City_Category, y = Total_Purchase, fill = City_Category)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "City Category") +
  theme_minimal() +
  scale_fill_manual(values = c("A" = "#efac37", "B" = "#e8615b", "C" = "#2f4a7f")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
cleaned_User_data$Stay_In_Current_City_Years <- factor(cleaned_User_data$Stay_In_Current_City_Years)

ggplot(cleaned_User_data, aes(x = Stay_In_Current_City_Years, y = Total_Purchase, fill = Stay_In_Current_City_Years)) + 
  geom_boxplot() +
  labs(y = "Total Purchase", x = "Stay In Current City Years") +
  theme_minimal() +
  scale_fill_manual(values = c("#2f4a7f", "#efac37", "#5982b2", "#e8615b", "#476b9e")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  ) +
  scale_y_continuous(labels = comma)
```

```{r}
cleaned_User_data$Marital_Status <- factor(cleaned_User_data$Marital_Status)

ggplot(cleaned_User_data, aes(x = Marital_Status, y = Total_Purchase, fill = Marital_Status)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "Marital Status") +
  theme_minimal() +
  scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_fill_manual(values = c("0" = "#efac37", "1" = "#e8615b")) +
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = Gender, y = Num_Purchases, fill = Gender)) + 
  geom_boxplot() +
  labs(y = "Number of Purchases", x = "Gender") +
  theme_minimal() +
  scale_fill_manual(values = c("M" = "#efac37", "F" = "#e8615b")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = Age, y = Num_Purchases, fill = Age)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "Age") +
  theme_minimal() +
  scale_fill_manual(values = c("0-17" = "#2f4a7f", "18-25" = "#efac37", "26-35" = "#162e4c", "36-45" = "#e8615b", "46-50" = "#476b9e", "51-55" = "#e5931c", "55+" = "#5982b2")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
ggplot(cleaned_User_data, aes(x = City_Category, y = Num_Purchases, fill = City_Category)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "City Category") +
  theme_minimal() +
  scale_fill_manual(values = c("A" = "#efac37", "B" = "#e8615b", "C" = "#2f4a7f")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_y_continuous(labels = comma)
```

```{r}
cleaned_User_data$Stay_In_Current_City_Years <- factor(cleaned_User_data$Stay_In_Current_City_Years)

ggplot(cleaned_User_data, aes(x = Stay_In_Current_City_Years, y = Num_Purchases, fill = Stay_In_Current_City_Years)) + 
  geom_boxplot() +
  labs(y = "Total Purchase", x = "Stay In Current City Years") +
  theme_minimal() +
  scale_fill_manual(values = c("#2f4a7f", "#efac37", "#5982b2", "#e8615b", "#476b9e")) +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  ) +
  scale_y_continuous(labels = comma)
```

```{r}
cleaned_User_data$Marital_Status <- factor(cleaned_User_data$Marital_Status)

ggplot(cleaned_User_data, aes(x = Marital_Status, y = Num_Purchases, fill = Marital_Status)) + 
  geom_boxplot() +
  labs(y = "Purchase", x = "Marital Status") +
  theme_minimal() +
  scale_x_discrete(labels = c("0" = "No", "1" = "Yes"))+
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )+
  scale_fill_manual(values = c("0" = "#efac37", "1" = "#e8615b")) +
  scale_y_continuous(labels = comma)
```

```{r}
gender_purchase_totals <- cleaned_User_data %>%
  group_by(Gender) %>%
  summarise(TotalPurchase = sum(Total_Purchase, na.rm = TRUE))  # na.rm = TRUE to remove NA values

# Now create the pie chart
ggplot(gender_purchase_totals, aes(x = "", y = TotalPurchase, fill = Gender)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +  # This converts the bar chart to pie chart
  theme_void() +  # Remove axes and background
  scale_fill_manual(values = c("M" = "#efac37", "F" = "#e8615b"))

gender_purchase_summary <- gender_purchase_totals %>%
  mutate(Percentage = (TotalPurchase / sum(TotalPurchase)) * 100)
print(gender_purchase_summary)
```

```{r}
Age_purchase_totals <- cleaned_User_data %>%
  group_by(Age) %>%
  summarise(TotalPurchase = sum(Total_Purchase, na.rm = TRUE))  # na.rm = TRUE to remove NA values

# Now create the pie chart
ggplot(Age_purchase_totals, aes(x = "", y = TotalPurchase, fill = Age)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +  # This converts the bar chart to pie chart
  theme_void() +  # Remove axes and background
  scale_fill_manual(values = c("0-17" = "#2f4a7f", "18-25" = "#efac37", "26-35" = "#162e4c", "36-45" = "#e8615b", "46-50" = "#476b9e", "51-55" = "#e5931c", "55+" = "#5982b2"))

Age_purchase_summary <- Age_purchase_totals %>%
  mutate(Percentage = (TotalPurchase / sum(TotalPurchase)) * 100)
print(Age_purchase_summary)
```

```{r}
City_Category_purchase_totals <- cleaned_User_data %>%
  group_by(City_Category) %>%
  summarise(TotalPurchase = sum(Total_Purchase, na.rm = TRUE))  # na.rm = TRUE to remove NA values

# Now create the pie chart
ggplot(City_Category_purchase_totals, aes(x = "", y = TotalPurchase, fill = City_Category)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +  # This converts the bar chart to pie chart
  theme_void() +  # Remove axes and background
  scale_fill_manual(values = c("A" = "#efac37", "B" = "#e8615b", "C" = "#2f4a7f"))

City_Category_purchase_summary <- City_Category_purchase_totals %>%
  mutate(Percentage = (TotalPurchase / sum(TotalPurchase)) * 100)
print(City_Category_purchase_summary)
```

```{r}
Stay_In_Current_City_Years_purchase_totals <- cleaned_User_data %>%
  group_by(Stay_In_Current_City_Years) %>%
  summarise(TotalPurchase = sum(Total_Purchase, na.rm = TRUE))  # na.rm = TRUE to remove NA values

# Now create the pie chart
ggplot(Stay_In_Current_City_Years_purchase_totals, aes(x = "", y = TotalPurchase, fill = Stay_In_Current_City_Years)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +  # This converts the bar chart to pie chart
  theme_void() +  # Remove axes and background
  scale_fill_manual(values = c("#2f4a7f", "#efac37", "#5982b2", "#e8615b", "#476b9e"))

Stay_In_Current_City_Years_purchase_summary <- Stay_In_Current_City_Years_purchase_totals %>%
  mutate(Percentage = (TotalPurchase / sum(TotalPurchase)) * 100)
print(Stay_In_Current_City_Years_purchase_summary)
```

```{r}
Marital_Status_purchase_totals <- cleaned_User_data %>%
  group_by(Marital_Status) %>%
  summarise(TotalPurchase = sum(Total_Purchase, na.rm = TRUE))  # na.rm = TRUE to remove NA values

# Now create the pie chart
ggplot(Marital_Status_purchase_totals, aes(x = "", y = TotalPurchase, fill = Marital_Status)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +  # This converts the bar chart to pie chart
  theme_void() +  # Remove axes and background
  scale_fill_manual(values = c("0" = "#efac37", "1" = "#e8615b"))

Marital_Status_purchase_summary <- Marital_Status_purchase_totals %>%
  mutate(Percentage = (TotalPurchase / sum(TotalPurchase)) * 100)
print(Marital_Status_purchase_summary)
```

```{r}
percentages_Gender <- prop.table(table(BlackFriday_cleaned$Product_Category_1, BlackFriday_cleaned$Gender), margin = 1) 
percentages_Gender_df <- as.data.frame(percentages_Gender)
colnames(percentages_Gender_df) <- c("Product_Category_1", "Gender", "Percentage_Gender")
ggplot(percentages_Gender_df, aes(x = Product_Category_1, y = Percentage_Gender, fill = Gender)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    x = "Product_Category_1",
    y = "Gender"
  )+
  scale_fill_manual(values = c("F" = "#efac37", "M" = "#5982b2"))+
  theme_minimal() +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )
```

```{r}
percentages_Age <- prop.table(table(BlackFriday_cleaned$Product_Category_1, BlackFriday_cleaned$Age), margin = 1) 
percentages_Age_df <- as.data.frame(percentages_Age)
colnames(percentages_Age_df) <- c("Product_Category_1", "Age", "Percentage_Age")
ggplot(percentages_Age_df, aes(x = Product_Category_1, y = Percentage_Age, fill = Age)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    x = "Product_Category_1",
    y = "Age"
  )+
  scale_fill_manual(values = c("0-17" = "#2f4a7f", "18-25" = "#efac37", "26-35" = "#476b9e", "36-45" = "#e8615b", "46-50" = "#476b9e", "51-55" = "#e5931c", "55+" = "#d9ebff"))+
  theme_minimal() +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )
```

```{r}
percentages_City_Category <- prop.table(table(BlackFriday_cleaned$Product_Category_1, BlackFriday_cleaned$City_Category), margin = 1) 
percentages_City_Category_df <- as.data.frame(percentages_City_Category)
colnames(percentages_City_Category_df) <- c("Product_Category_1", "City_Category", "Percentage_City_Category")
ggplot(percentages_City_Category_df, aes(x = Product_Category_1, y = Percentage_City_Category, fill = City_Category)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    x = "Product_Category_1",
    y = "City_Category"
  )+
  scale_fill_manual(values = c("A" = "#efac37", "B" = "#e8615b", "C" = "#2f4a7f"))+
  theme_minimal() +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )
```

```{r}
percentages_Stay_In_Current_City_Years <- prop.table(table(BlackFriday_cleaned$Product_Category_1, BlackFriday_cleaned$Stay_In_Current_City_Years), margin = 1) 
percentages_Stay_In_Current_City_Years_df <- as.data.frame(percentages_Stay_In_Current_City_Years)
colnames(percentages_Stay_In_Current_City_Years_df) <- c("Product_Category_1", "Stay_In_Current_City_Years", "Percentage_Stay_In_Current_City_Years")
ggplot(percentages_Stay_In_Current_City_Years_df, aes(x = Product_Category_1, y = Percentage_Stay_In_Current_City_Years, fill = Stay_In_Current_City_Years)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    x = "Product_Category_1",
    y = "Stay_In_Current_City_Years"
  )+
  scale_fill_manual(values = c("0" = "#2f4a7f", "1" = "#efac37", "2" = "#5982b2", "3" = "#e8615b", "4" = "#476b9e"))+
  theme_minimal() +
  theme(
    plot.title = element_text(size = 25),        
    axis.title.x = element_text(size = 20),      
    axis.title.y = element_text(size = 20),      
    axis.text.x = element_text(size = 20),       
    axis.text.y = element_text(size = 20)        
  )
```


##  Sample Statistics
### Sample Statistics for User Data (Mean)

```{r}
summarize_statistics = function(dataset) {
  
  dataset = select_if(dataset, is.numeric)
  summary.table = data.frame(Attribute = names(dataset))
  
  summary.table = summary.table %>% 
    mutate('Mean' = colMeans(dataset, na.rm = TRUE),
           'SD' = apply(dataset, 2, function (x) sd(x, na.rm = TRUE)),
           'SE_Classic' = apply(dataset, 2, function (x) sd(x, na.rm = TRUE)/
                                  sqrt(length(x))),
           'SE_Bootstrap' = apply(dataset, 2, function (x) {
             set.seed(1)
             sample_means = rep(0, 1000)
             for (i in 1:1000) {
               sample_means[i] = mean(sample(x, length(x), replace = TRUE))
             }
             se_bootstrap = sd(sample_means)
             se_bootstrap
           }),
           '90%_CI_Classic' = apply(dataset, 2, function (x) {
             ci_lower = mean(x)-1.96*sd(x, na.rm = TRUE)/
                                  sqrt(length(x))
             ci_upper = mean(x)+1.96*sd(x, na.rm = TRUE)/
                                  sqrt(length(x))
             paste0("[", round(ci_lower, 2), ", ", round(ci_upper, 2), "]")
           }),
           '90%_CI_Bootstrap' = apply(dataset, 2, function (x) {
             set.seed(1)
             sample_means = rep(0, 1000)
             for (i in 1:1000) {
               sample_means[i] = mean(sample(x, length(x), replace = TRUE))
             }
             ci_lower = quantile(sample_means, 0.05)
             ci_upper = quantile(sample_means, 0.95)
             paste0("[", round(ci_lower, 2), ", ", round(ci_upper, 2), "]")
           })
    )
  summary.table
}
```


```{r}
summarize_statistics(cleaned_User_data)
```


### Sample Statistics for Product Data (Mean)
```{r}
summarize_statistics(cleaned_Product_data)
```



## Hypothesis Testing for Customer Information

### Total_Purchase

One-tailed hypothesis test to determine if there is a statistically significant difference between the total purchase of female and male.

Classical
```{r}
female <- cleaned_User_data$Total_Purchase[cleaned_User_data$Gender == 'F']
male <- cleaned_User_data$Total_Purchase[cleaned_User_data$Gender == 'M']

t.test(female, male, alternative = "greater")
```

Permutation Testing

```{r}
perm_fun <- function(x, nA)
{
  n = length(x)
  nB = n - nA
  idx_b <- sample(1:n, nB)
  idx_a <- setdiff(1:n, idx_b)
  perm_diffs <- mean(x[idx_b]) - mean(x[idx_a])
  return(list(idx_a = idx_a, idx_b = idx_b, perm_diffs = perm_diffs))
}
```

```{r}
set.seed(1)
obs_diff <- mean(female) - mean(male)

perm_diffs <- replicate(10000, {
  permuted_data <- sample(c(female, male))  
  new_female <- permuted_data[1:length(female)]  
  new_male <- permuted_data[(length(male) + 1):length(permuted_data)]
  mean(new_female) - mean(new_male)
})

p_value <- mean(perm_diffs >= obs_diff)
p_value
```

```{r}
ggplot(as_tibble(perm_diffs)) + geom_histogram(aes(x=value), fill = "#e8615b") +
  labs(title = "Check Differences")+
  geom_vline(xintercept = obs_diff, linetype = "dashed", size = 0.8)+
  geom_text(aes(x=obs_diff), label="\nObserved Difference", y=100, hjust="left")
```



One-tailed hypothesis test to determine if there is a statistically significant difference between the total purchase of unmarried customers and married customers.

Classical
```{r}
unmarried <- cleaned_User_data$Total_Purchase[cleaned_User_data$Marital_Status == 0]
married <- cleaned_User_data$Total_Purchase[cleaned_User_data$Marital_Status == 1]

t.test(unmarried, married, alternative = "greater")
```

Permutation Testing

```{r}
set.seed(1)
obs_diff <- mean(unmarried) - mean(married)

perm_diffs <- replicate(10000, {
  permuted_data <- sample(c(unmarried, married))  
  new_unmarried <- permuted_data[1:length(unmarried)]  
  new_married <- permuted_data[(length(married) + 1):length(permuted_data)]
  mean(new_unmarried) - mean(new_married)
})

p_value <- mean(perm_diffs >= obs_diff)
p_value
```

```{r}
ggplot(as_tibble(perm_diffs)) + geom_histogram(aes(x=value), fill = "#e8615b") +
  labs(title = "Check Differences")+
  geom_vline(xintercept = obs_diff, linetype = "dashed", size = 0.8)+
  geom_text(aes(x=obs_diff), label="\nObserved Difference", y=100, hjust="left")
```



One-way ANOVA to determine if there are statistically significant differences among the total purchase of different city categories

Classical

```{r}
summary(aovp(Total_Purchase ~ Age, data=cleaned_User_data))
```

Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Total_Purchase, cleaned_User_data$Age, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_total_purchase <- sample(cleaned_User_data$Total_Purchase)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Total_Purchase <- shuffled_total_purchase
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Total_Purchase, cleaned_User_data$Age, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```


One-way ANOVA to determine if there are statistically significant differences among the total purchase of different age groups

Classical

```{r}
summary(aovp(Total_Purchase ~ City_Category, data=cleaned_User_data))
```

Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Total_Purchase, cleaned_User_data$City_Category, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_total_purchase <- sample(cleaned_User_data$Total_Purchase)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Total_Purchase <- shuffled_total_purchase
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Total_Purchase, cleaned_User_data$City_Category, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```


One-way ANOVA to determine if there are statistically significant differences among the total purchase of different groups with years stay in current city

Classical

```{r}
summary(aovp(Total_Purchase ~ Stay_In_Current_City_Years, data=cleaned_User_data))
```

Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Total_Purchase, cleaned_User_data$Stay_In_Current_City_Years, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_total_purchase <- sample(cleaned_User_data$Total_Purchase)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Total_Purchase <- shuffled_total_purchase
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Total_Purchase, cleaned_User_data$Stay_In_Current_City_Years, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```

### Num_Purchases

One-tailed hypothesis test to determine if there is a statistically significant difference between the number of purchase of female and male.

Classical
```{r}
female <- cleaned_User_data$Num_Purchases[cleaned_User_data$Gender == 'F']
male <- cleaned_User_data$Num_Purchases[cleaned_User_data$Gender == 'M']

t.test(female, male, alternative = "greater")
```



Permutation Testing


```{r}
set.seed(1)
obs_diff <- mean(female) - mean(male)

perm_diffs <- replicate(10000, {
  permuted_data <- sample(c(female, male))  
  new_female <- permuted_data[1:length(female)]  
  new_male <- permuted_data[(length(male) + 1):length(permuted_data)]
  mean(new_female) - mean(new_male)
})

p_value <- mean(perm_diffs >= obs_diff)
p_value
```

```{r}
ggplot(as_tibble(perm_diffs)) + geom_histogram(aes(x=value), fill = "#e8615b") +
  labs(title = "Check Differences")+
  geom_vline(xintercept = obs_diff, linetype = "dashed", size = 0.8)+
  geom_text(aes(x=obs_diff), label="\nObserved Difference", y=100, hjust="left")
```





One-tailed hypothesis test to determine if there is a statistically significant difference between the number of purchase of unmarried customers and married customers.

Classical
```{r}
unmarried <- cleaned_User_data$Num_Purchases[cleaned_User_data$Marital_Status == 0]
married <- cleaned_User_data$Num_Purchases[cleaned_User_data$Marital_Status == 1]

t.test(unmarried, married, alternative = "greater")
```

Permutation Testing

```{r}
set.seed(1)
obs_diff <- mean(unmarried) - mean(married)

perm_diffs <- replicate(10000, {
  permuted_data <- sample(c(unmarried, married))  
  new_unmarried <- permuted_data[1:length(unmarried)]  
  new_married <- permuted_data[(length(married) + 1):length(permuted_data)]
  mean(new_unmarried) - mean(new_married)
})

p_value <- mean(perm_diffs >= obs_diff)
p_value
```

```{r}
ggplot(as_tibble(perm_diffs)) + geom_histogram(aes(x=value), fill = "#e8615b") +
  labs(title = "Check Differences")+
  geom_vline(xintercept = obs_diff, linetype = "dashed", size = 0.8)+
  geom_text(aes(x=obs_diff), label="\nObserved Difference", y=100, hjust="left")
```

One-way ANOVA to determine if there are statistically significant differences among the number of purchase of different city categories

Classical

```{r}
summary(aovp(Num_Purchases ~ Age, data=cleaned_User_data))
```

Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Num_Purchases, cleaned_User_data$Age, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_Num_Purchases <- sample(cleaned_User_data$Num_Purchases)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Num_Purchases <- shuffled_Num_Purchases
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Num_Purchases, cleaned_User_data$Age, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```


One-way ANOVA to determine if there are statistically significant differences among the number of purchase of different age groups

Classical

```{r}
summary(aovp(Num_Purchases ~ City_Category, data=cleaned_User_data))
```



Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Num_Purchases, cleaned_User_data$City_Category, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_Num_Purchases <- sample(cleaned_User_data$Num_Purchases)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Num_Purchases <- shuffled_Num_Purchases
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Num_Purchases, cleaned_User_data$City_Category, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```


One-way ANOVA to determine if there are statistically significant differences among the number of purchase of different groups with years stay in current city

Classical

```{r}
summary(aovp(Num_Purchases ~ Stay_In_Current_City_Years, data=cleaned_User_data))
```

Computational

```{r}
obs_var <- var(tapply(cleaned_User_data$Num_Purchases, cleaned_User_data$Stay_In_Current_City_Years, mean))

# Permute and compute test statistics
set.seed(1)
vars <- replicate(10000, {
  # Shuffle the bills
  shuffled_Num_Purchases <- sample(cleaned_User_data$Num_Purchases)
  # Assign them back to the original data frame (maintaining sample sizes but ignoring labels)
  cleaned_User_data$Shuffled_Num_Purchases <- shuffled_Num_Purchases
  # Compute the variance in means for the permuted data
  var(tapply(cleaned_User_data$Shuffled_Num_Purchases, cleaned_User_data$Stay_In_Current_City_Years, mean))
})

# Compute p-value
p_value <- mean(vars >= obs_var)
p_value
```

## Chi-Squared Test for Independence
A chi-squared test is used to determine if there is a significant association between two categorical variables. 

Gender & Age

```{r}
contingency_table <- table(cleaned_User_data$Gender, cleaned_User_data$Age)
chisq.test(contingency_table)
```


```{r}
contingency_df <- as.matrix(contingency_table)
legend_colors <- c("#e8615b", "#2f4a7f")
legend_labels <- c("Female", "Male")

stacked_bar_chart <- barplot(contingency_df, beside = TRUE, col = legend_colors,
                             main = "Female vs Male in Different Age Groups",
                             xlab = "Age Groups", ylab = "Frequency",
                             names.arg = colnames(contingency_df))

legend("topright", legend = legend_labels, fill = legend_colors)
```



Gender & Marital_Status

```{r}
contingency_table <- table(cleaned_User_data$Gender, cleaned_User_data$Marital_Status)
chisq.test(contingency_table)
```


```{r}
contingency_df <- as.matrix(contingency_table)
legend_colors <- c("#e8615b", "#2f4a7f")
legend_labels <- c("Female", "Male")

stacked_bar_chart <- barplot(contingency_df, beside = TRUE, col = legend_colors,
                             main = "Female vs Male in Different Marital_Status",
                             xlab = "Marital Status", ylab = "Frequency",
                             names.arg = colnames(contingency_df))

legend("topright", legend = legend_labels, fill = legend_colors)
```



City_Category & Stay_In_Current_City_Years

```{r}
contingency_table <- table(cleaned_User_data$City_Category, cleaned_User_data$Stay_In_Current_City_Years)
chisq.test(contingency_table)
```


```{r}
contingency_df <- as.matrix(contingency_table)
legend_colors <- c("#e8615b", "#2f4a7f", "#efac37")
legend_labels <- c("A", "B", "C")

stacked_bar_chart <- barplot(contingency_df, beside = TRUE, col = legend_colors,
                             main = "City Category A vs B vs C in Different Years of stay in Current city",
                             xlab = "Years of stay in Current city", ylab = "Frequency",
                             names.arg = colnames(contingency_df))

legend("topright", legend = legend_labels, fill = legend_colors)
```



















































